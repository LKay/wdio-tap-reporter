machine:
  timezone:
    Asia/Tokyo
  environment:
    PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"


dependencies:
  pre:
    - curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
    - echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
    - sudo apt-get update
    - sudo apt-get install nodejs yarn
    - echo "node `node -v`"
    - echo "yarn `yarn --version`"
    - yarn global add coveralls

  override:
    - yarn

  cache_directories:
    - ~/.cache/yarn

test:
  override:
    - yarn test

  post:
    - yarn run coverage

compile:
  pre:
    - yarn run clean
  override:
    - yarn run build

deployment:
  production:
    tag: /v[0-9]+(\.[0-9]+){2}/
    owner: LKay
    commands:
      # until yarn has better CLI we have to use this...
      - echo -e "$NPM_USERNAME\n$NPM_PASSWORD\n$NPM_EMAIL" | npm login
      - npm publish
      - npm logout
